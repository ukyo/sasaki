// sasaki 0.1.1 License: MIT https://github.com/ukyo/sasaki
(function(t,e){e.Deferred=t;var n,r=function(t,e){return function(){return t.apply(e,arguments)}},i=[].slice;n={},function(){var t,e;return e=function(){function t(t){this._deferred=t}return t.prototype.then=function(t,e){return this._deferred._queue.push({onResolved:t,onRejected:e}),this},t.prototype.done=function(t){return this.then(t)},t.prototype.fail=function(t){return this.then(null,t)},t.prototype.always=function(t){return this.then(t,t)},t}(),t=function(){function t(){this.rejectWith=r(this.rejectWith,this),this.reject=r(this.reject,this),this.resolveWith=r(this.resolveWith,this),this.resolve=r(this.resolve,this),this._queue=[],this._context=null}return t.prototype._transition=function(e,n){var r,o,u,s,h,c,l,f=this;if(this._queue.length){if(r=this._queue.shift(),u=e?r.onResolved:r.onRejected,"function"!=typeof u)return this._transition(e,n);try{return c=u.apply(this._context,n),t.isPromise(c)?(l=function(){var t;return null!=(null!=(t=c._deferred)?t._context:void 0)?f._context=c._deferred._context:void 0},h=function(){var t;return t=arguments.length>=1?i.call(arguments,0):[],l(),f.resolve.apply(f,t)},s=function(t){return l(),f.reject(t)},c.then(h,s)):this.resolve(c)}catch(a){return o=a,this.reject(o)}}},t.prototype.resolve=function(){return this._transition(!0,arguments)},t.prototype.resolveWith=function(){var t,e;return e=arguments[0],t=arguments.length>=2?i.call(arguments,1):[],this._context=e,this._transition(!0,t)},t.prototype.reject=function(){return this._transition(!1,arguments)},t.prototype.rejectWith=function(){var t,e;return e=arguments[0],t=arguments.length>=2?i.call(arguments,1):[],this._context=e,this._transition(!1,t)},t.prototype.then=function(t,e){return this._queue.push({onResolved:t,onRejected:e}),this},t.prototype.done=function(t){return this.then(t)},t.prototype.fail=function(t){return this.then(null,t)},t.prototype.always=function(t){return this.then(t,t)},t.prototype.promise=function(){return new e(this)},t}(),t.isPromise=function(t){return t&&"function"==typeof t.then},n.defer=function(){return new t},n.Deferred=t,n.Promise=e,n.when=function(){var e,n,r,o,u,s,h;return e=arguments.length>=1?i.call(arguments,0):[],1===e.length&&Array.isArray(e[0])&&(e=e[0]),r=new t,h=[],n=e.length,o=!1,s=function(t,e){return o?void 0:(h[t]=1===e.length?e[0]:e,--n?void 0:r.resolve.apply(r,h))},u=function(t){return o?void 0:(o=!0,r.reject(t))},e.forEach(function(e,n){return t.isPromise(e)?e.then(function(){var t;return t=arguments.length>=1?i.call(arguments,0):[],s(n,t)},u):s(n,e)}),r.promise()}}(),"function"==typeof define&&null!=define.amd?define(function(){return n}):null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=n:e.sasaki=n})({},function(){return this}());